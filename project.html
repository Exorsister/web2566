<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, maximum-scale=1">
    <title>Jurassic Park</title>
    <link rel="stylesheet" href="./styles.css">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <script src="./animation-controls.js"></script>
    <script
        src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
</head>

<body>

    <a-scene environment="preset: forest; lighting: point; lightPosition: -5 10 0;">
        <a-assets>
            <a-asset-item id="Tyranno" response-type="arraybuffer" src="./project/Dinosaur/tyranno.glb"></a-asset-item>
            <a-asset-item id="Triceratop" response-type="arraybuffer"
                src="./project/Dinosaur/Triceratops.glb"></a-asset-item>
        </a-assets>

        <a-entity id="rig" position="0 0 10" movement-controls="constrainToNavMesh: true;
                           controls: checkpoint, gamepad, trackpad, keyboard, nipple;" position="-7 0 21">
            <a-entity camera position="0 1.6 0" look-controls="pointerLockEnabled: true">
                <a-cursor></a-cursor>
            </a-entity>
        </a-entity>

        <!-- Tyranno -->
        <a-entity id="tyranno" gltf-model="#Tyranno" position="0 0 -4" scale="2 2 2" rotation="0 -90 0"
            animation-mixer="clip: Idle2;"></a-entity>
        <!-- Triceratop -->
        <a-entity id="triceratop" gltf-model="#Triceratop" position="8 0 -4" scale="2 2 2" rotation="0 -90 0"
            animation-mixer="clip: Idle;"></a-entity>

        <a-entity id="RoarBox" position="-0.788 7.5 -3.5" scale="0.3 0.3 0.3"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5"
            onclick="changeAnimation('Roar');">
        </a-entity>


        <a-entity id="AttackBox" position="0.720 7.5 -3.5" scale="0.3 0.3 0.3"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5"
            onclick="changeAnimation('Attack');">
        </a-entity>


        <a-entity id="FallBox" position="2.350 7.5 -3.5" scale="0.3 0.3 0.3"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5"
            onclick="changeAnimation('Fall');">
        </a-entity>


        <a-entity id="HeadButtBox" position="3.5 5.5 -3.5" scale="0.3 0.3 0.3"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5"
            onclick="changeAnimation('HeadButt');">
        </a-entity>

        <a-entity id="WalkBox" position="-4 5.5 -3.5" scale="0.3 0.3 0.3"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5"
            onclick="changeAnimation('Walk');">
        </a-entity>

        <a-entity id="Idle2box" position="-2.438 7.5 -3.5" scale="0.3 0.3 0.3"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5"
            onclick="changeAnimation('Idle2');">
        </a-entity>

        <!-- Triceratop -->
        <a-entity id="TriIdleBox" position="11 10.2 -3.5" scale="0.3 0.3 0.3"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5"
            onclick="changeTriAnimation('Run');"></a-entity>

        <a-entity id="Position1" checkpoint="offset: 0 0 0;" position="0 0.8 10" scale="0.2 0.2 0.2"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5" levitate>
        </a-entity>

        <a-entity id="Position2" checkpoint="offset: 0 0 0;" position="8 0.8 10" scale="0.2 0.2 0.2"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5" levitate>
        </a-entity>

        <a-entity id="Position3" checkpoint="offset: 0 0 0;" position="-8 0.8 10" scale="0.2 0.2 0.2"
            geometry="primitive: box; width: 4; height: 4; depth: 4;" material="color: #33FF66; opacity: 0.5" levitate>
        </a-entity>
    </a-scene>

    <script>
        // document.addEventListener("DOMContentLoaded", function () {

        //     // รอให้ aframe-extras เสร็จสิ้นการโหลด GLB
        //     document.querySelector('a-scene').addEventListener('loaded', function () {

        //         // หลังจากโหลดเสร็จแล้วจึงทำการตั้งค่า animation-mixer สำหรับ Tyranno
        //         var tyrannoEntity = document.getElementById("tyranno");
        //         var tyrannoAnimationMixer = tyrannoEntity.components["animation-mixer"];
        //         if (tyrannoAnimationMixer && tyrannoAnimationMixer.data) {
        //             // ตรวจสอบชื่อ animation clip ที่มีอยู่ในไฟล์ GLB และตั้งค่า
        //             var tyrannoAvailableClips = tyrannoAnimationMixer.data.clips;
        //             if (tyrannoAvailableClips && tyrannoAvailableClips.length > 0) {
        //                 tyrannoAnimationMixer.data.clip = tyrannoAvailableClips[0].name; // ให้ใช้ clip แรก
        //             }
        //         }

        //         // หลังจากโหลดเสร็จแล้วจึงทำการตั้งค่า animation-mixer สำหรับ Triceratops
        //         var triceratopsEntity = document.getElementById("triceratop");
        //         var triceratopsAnimationMixer = triceratopsEntity.components["animation-mixer"];
        //         if (triceratopsAnimationMixer && triceratopsAnimationMixer.data) {
        //             // ตรวจสอบชื่อ animation clip ที่มีอยู่ในไฟล์ GLB และตั้งค่า
        //             var triceratopsAvailableClips = triceratopsAnimationMixer.data.clips;
        //             if (triceratopsAvailableClips && triceratopsAvailableClips.length > 0) {
        //                 triceratopsAnimationMixer.data.clip = triceratopsAvailableClips[0].name; // ให้ใช้ clip แรก
        //             }
        //         }
        //     });
        // });


        // เพิ่มฟังก์ชันเปลี่ยน animation
        function changeAnimation(newAnimation) {
            var dinosaurEntity = document.getElementById("tyranno");
            var animationMixer = dinosaurEntity.components["animation-mixer"];

            if (animationMixer && animationMixer.data) {
                animationMixer.data.clip = newAnimation;

                // หากต้องการเล่น animation ทันทีหลังจากการเปลี่ยน clip
                animationMixer.stopAction(); // หยุดการเล่น animation ที่กำลังเล่น
                animationMixer.playAction(); // เริ่มเล่น animation ที่กำหนด
            }
        }

        function changeTriAnimation(newAnimation) {
            var triceratopsEntity = document.getElementById("triceratop");
            var triAnimationMixer = triceratopsEntity.components["animation-mixer"];

            if (triAnimationMixer && triAnimationMixer.data) {
                triAnimationMixer.data.clip = newAnimation;

                // หากต้องการเล่น animation ทันทีหลังจากการเปลี่ยน clip
                triAnimationMixer.stopAction(); // หยุดการเล่น animation ที่กำลังเล่น
                triAnimationMixer.playAction(); // เริ่มเล่น animation ที่กำหนด
            }
        }

    </script>
</body>

</html>